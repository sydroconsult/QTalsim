<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sub-basins preprocessing &#8212; QTalsim 1.6.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=89b800e6" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=08abc459"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ISRIC Soil Type Converter" href="doc_soil.html" />
    <link rel="prev" title="Step by Step" href="hrus_step_by_step.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="doc_soil.html" title="ISRIC Soil Type Converter"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hrus_step_by_step.html" title="Step by Step"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">QTalsim 1.6.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sub-basins preprocessing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sub-basins-preprocessing">
<h1>Sub-basins preprocessing<a class="headerlink" href="#sub-basins-preprocessing" title="Permalink to this heading">¶</a></h1>
<blockquote>
<div><p>The third core functionality allows you to pre-process a sub-basins layer. It calculates the highest and lowest points within the sub-basins, the area and average impermeable area (optional) per sub-basin, and the longest flow path for each sub-basin. Output includes a line layer containing the longest flow paths, a sub-basins layer (and Geopackage) containing the sub-basins with all calculated parameters and an .EZG-ASCII file, which can be used as <a class="reference external" href="https://www.talsim.de/docs/index.php?title=EZG-Datei">input to Talsim</a> (optional). Please note that to use this functionality the QGIS-Plugin WhiteboxTools must be installed.</p>
</div></blockquote>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>Input Layers:</strong></p>
<ul class="simple">
<li><p>Sub-basin layer: For optimal performance, the sub-basin layer should be continuous, with no gaps or holes (e.g., no empty areas for dams)</p></li>
<li><p>Digital Elevation Model (DEM) layer</p></li>
<li><p>Optional: Water network layer (necessary for LongestFlowPath-calculation)</p></li>
<li><p>Optional: Layer with impervious areas</p></li>
</ul>
<p>To use this plugin’s functionality, WhiteboxTools must be installed.</p>
<ul class="simple">
<li><p>WhiteboxTools: Install the “WhiteboxTools for QGIS” plugin, and make sure the environment path is set correctly.</p>
<ul>
<li><p>Install the “WhiteboxTools for QGIS” plugin.</p></li>
<li><p>Download and install <a class="reference external" href="https://www.whiteboxgeo.com/download-whiteboxtools/">WhiteboxTools Open Core</a> and remember the path where you installed it.</p></li>
<li><p>In QGIS go to Settings - Options - Processing - Providers - WhiteboxTools executable and insert the path to the binary of your download (e.g. C:/Users/Test/WhiteboxTools_win_amd64/WBT/whitebox_tools.exe).</p></li>
<li><p>For further guidance, you can watch this instructional <a class="reference external" href="https://www.youtube.com/watch?v=xJXDBsNbcTg">video</a> produced by Whitebox.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
<section id="executing-the-plugin">
<h2>Executing the Plugin<a class="headerlink" href="#executing-the-plugin" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>After installing WhiteboxTools, you can run the plugin.</p>
</div></blockquote>
<section id="select-layers">
<h3>Select Layers<a class="headerlink" href="#select-layers" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Choose the correct polygon layer for the sub-basin layer.</p></li>
<li><p>Select the field that contains the unique identifier for the sub-basins.</p></li>
<li><p>Select the field that contains the names of the sub-basins.</p></li>
<li><p>Select the DEM layer (raster layer) and the water network layer (line layer). The water network layer is only necessary for calculating LFP.</p></li>
<li><p>Optional: Select a layer containing impervious areas (<a class="reference external" href="https://sdi.eea.europa.eu/catalogue/srv/eng/catalog.search#/metadata/3bf542bd-eebd-4d73-b53c-a0243f2ed862">Example data set</a>).</p>
<ul>
<li><p>Values should be expressed as percentages</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
<section id="calculation-of-longestflowpath">
<h3>Calculation of LongestFlowPath<a class="headerlink" href="#calculation-of-longestflowpath" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>The calculation of LongestFlowPath is optional. The plugin first burns the water network into the DEM using the QGIS “Raster calculator”.
It then applies Whitebox’ “FillDepressionsWangAndLiu” tool to fill any sinks in the DEM. After this the plugin uses WhiteboxTools’ “LongestFlowPath” (LFP) to generate the longest flowpath for each sub-basin. To address an issue with LFP creating disconnected flowpaths across different sub-basins (see details <a class="reference external" href="https://github.com/jblindsay/whitebox-tools/issues/289">here</a>), the plugin processes each sub-basin individually, generating the LFP for each one separately. Finally, the plugin saves the correct LFP for each sub-basin and merges them into a single layer.</p>
<p>The final LFP layer is added to the current QGIS project and saved to the specified output folder. Additionally, the burned and filled DEM layer is also saved and added to the current project.</p>
</div></blockquote>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>When choosing the output folder, it is recommended to use a folder that does not contain any spatial files, as using the same file names can lead to issues.</p></li>
<li><p>Select ASCII-Export and/or SQLite-Export</p></li>
<li><p>ASCII-Export: Choose ASCII-Output to input a filename for the .EZG-ASCII-file.</p></li>
<li><p>SQLite-Export: Insert names for scenario and database.</p></li>
<li><p>Output Parameters:</p>
<ul>
<li><p>Area of sub-basin in hectares [ha].</p></li>
<li><p>Optional: Average impervious area in the sub-basin [%] (=field ‘Imp_mean’).</p></li>
<li><p>Maximum height in sub-basin [MASL].</p></li>
<li><p>Minimum height in sub-basin [MASL].</p></li>
<li><p>Optional (if calculated): Longest flow path [m] (=field ‘Length’).</p></li>
</ul>
</li>
</ul>
<p><img alt="Screenshot Sub-basin preprocessing" src="_images/SubBasinPreprocessing.png" /></p>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/QTalsim_logo.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install_plugin.html">Install Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_qtalsim.html">HRU calculation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sub-basins preprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#executing-the-plugin">Executing the Plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doc_soil.html">ISRIC Soil Type Converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_landuse.html">Land use mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_connect_to_db.html">Connect to Talsim DB</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="doc_soil.html" title="ISRIC Soil Type Converter"
             >next</a> |</li>
        <li class="right" >
          <a href="hrus_step_by_step.html" title="Step by Step"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">QTalsim 1.6.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sub-basins preprocessing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Sydro Consult GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    </div>
  </body>
</html>